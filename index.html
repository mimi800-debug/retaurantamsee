<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerichte ‚Äì Client & Admin (Single File)</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --panel-2: #1f2937;
      --accent: #22d3ee;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --ok: #22c55e;
      --warn: #f59e0b;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: radial-gradient(1200px 800px at 10% 10%, #0b1226 0, var(--bg) 60%);
      color: var(--text);
    }
    .wrap { max-width: 1000px; margin: 0 auto; padding: 24px; }
    header {
      display: flex; gap: 12px; align-items: center; justify-content: space-between;
      margin-bottom: 16px;
    }
    .brand { font-weight: 700; letter-spacing: .2px; display: flex; gap: 10px; align-items: center;}
    .brand-badge {
      width: 28px; height: 28px; border-radius: 8px; background: linear-gradient(135deg, #22d3ee, #22c55e);
      box-shadow: 0 0 20px rgba(34, 211, 238, .35);
    }
    nav { display: flex; gap: 8px; }
    a.btn {
      text-decoration: none; color: var(--text);
      padding: 10px 14px; border-radius: 12px; background: #0b1220; border: 1px solid #1f2a44;
    }
    a.btn.active, a.btn:hover { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(34,211,238,.15) inset; }
    .panel {
      background: linear-gradient(180deg, var(--panel) 0, var(--panel-2) 100%);
      border: 1px solid #243048; border-radius: 16px; padding: 18px; margin: 12px 0;
      box-shadow: 0 10px 30px rgba(2,6,23,.35);
    }
    h1,h2,h3 { margin: 6px 0 10px; }
    h1 { font-size: 26px; }
    h2 { font-size: 20px; color: var(--accent); }
    .grid { display: grid; gap: 14px; }
    @media (min-width: 900px) { .grid-2 { grid-template-columns: 1fr 1fr; } }
    label { font-size: 14px; color: var(--muted); display:block; margin-bottom:6px; }
    input, textarea, select {
      width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid #2a385a;
      background: #0b1220; color: var(--text); outline: none;
    }
    textarea { min-height: 72px; resize: vertical; }
    .row { display: flex; gap: 10px; }
    .row > * { flex: 1; }
    .actions { display: flex; gap: 8px; flex-wrap: wrap; }
    button {
      padding: 10px 14px; border-radius: 12px; border: 1px solid #2a385a;
      background: #0b1220; color: var(--text); cursor: pointer;
    }
    button.primary { border-color: var(--accent); }
    button.ok { border-color: var(--ok); }
    button.warn { border-color: var(--warn); }
    button.danger { border-color: var(--danger); }
    .muted { color: var(--muted); font-size: 14px; }
    .list { display: grid; gap: 10px; }
    .item {
      display: grid; gap: 6px; padding: 12px; border: 1px solid #25314c; border-radius: 14px;
      background: #0b1220;
    }
    .item-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; }
    .badge {
      padding: 4px 8px; border-radius: 999px; border: 1px solid #2a385a; font-size: 12px;
    }
    .badge.ok { border-color: var(--ok); }
    .badge.warn { border-color: var(--warn); }
    .empty {
      padding: 16px; border: 1px dashed #2a385a; border-radius: 12px; color: var(--muted);
      text-align: center;
    }
    .footer { margin-top: 24px; color: var(--muted); font-size: 12px; text-align: center; }
    .hint { font-size: 12px; color: var(--muted); margin-top: 6px; }
    .dish-checkbox-row { display:flex; align-items:center; gap:10px; padding:8px; border-radius:10px; background:transparent; border:1px solid transparent; }
    .dish-checkbox-row input[type="checkbox"] { width:18px; height:18px; }
    .dish-checkbox-row label { cursor:pointer; }
    ul.inline-list { margin:0; padding-left:18px; }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="brand-badge" aria-hidden="true"></div>
      <div>
        <div style="font-size:14px;color:var(--muted)">Single-File App</div>
        <div style="font-size:18px">Gerichte ‚Äì Client & Admin</div>
      </div>
    </div>
    <nav>
      <a href="#/client" id="link-client" class="btn">Client</a>
    </nav>
  </header>

  <section id="view-client" class="panel" hidden>
    <h1>Bestellung aufgeben</h1>
    <div class="grid grid-2">
      <div class="panel">
        <h2>1) Gerichte w√§hlen</h2>
        <div id="client-dish-picker"></div>
      </div>
      <div class="panel">
        <h2>2) Wohin & Name</h2>
        <form id="order-form">
          <label for="customer-name">Name</label>
          <input id="customer-name" name="customer-name" placeholder="Max Mustermann" required />

          <label for="destination">Wohin</label>
          <input id="destination" name="destination" placeholder="z. B. Musterstra√üe 12, 12345 Musterstadt" required />

          <div class="actions" style="margin-top:10px">
            <button class="primary" type="submit">Bestellen</button>
            <button type="reset" id="order-reset-btn">Zur√ºcksetzen</button>
          </div>
          <div class="hint">Nach Absenden erscheint deine Bestellung im Admin-Bereich.</div>
        </form>
      </div>
    </div>
  </section>

  <section id="view-admin" class="panel" hidden>
    <h1>Admin</h1>
    <div class="grid grid-2">
      <div class="panel">
        <h2>Gerichte verwalten</h2>
        <form id="dish-form">
          <label for="dish-name">Gericht</label>
          <input id="dish-name" placeholder="z. B. Spaghetti Bolognese" required />
          <div class="row">
            <div>
              <label for="dish-price">Preis (‚Ç¨)</label>
              <input id="dish-price" type="number" step="0.01" min="0" placeholder="9.90" />
            </div>
            <div>
              <label for="dish-tags">Tags (optional)</label>
              <input id="dish-tags" placeholder="vegan, fleisch, salat" />
            </div>
          </div>
          <div class="actions">
            <button class="primary" type="submit">Hinzuf√ºgen / Speichern</button>
            <button type="button" id="dish-reset-btn">Zur√ºcksetzen</button>
          </div>
        </form>
        <div id="dish-list" class="list"></div>
      </div>
      <div class="panel">
        <h2>Bestellungen</h2>
        <div id="order-list" class="list"></div>
      </div>
    </div>
  </section>

  <div class="footer">¬© 2025 ‚Äì Emil Beer</div>
</div>

<script>
const REMOTE_SYNC_DISHES = true;
const REMOTE_SYNC_ORDERS = true;
const JSONBIN_KEY = "$2a$10$N/2gxnECUzbO8QCffVQ7Ye6N5Oare5DGjQCPaTkkcovABoafVICSS"; // Master Key
const JSONBIN_DISHES_ID = "68a5d4feae596e708fcf10d3";
const JSONBIN_ORDERS_ID = "68a5e44a43b1c97be9236b9e";

let dishes = [];
let orders = [];

// --- Utility ---
function saveLocal() {
  localStorage.setItem("dishes", JSON.stringify(dishes));
  localStorage.setItem("orders", JSON.stringify(orders));
}

function loadLocal() {
  const d = localStorage.getItem("dishes");
  if(d) dishes = JSON.parse(d);
  const o = localStorage.getItem("orders");
  if(o) orders = JSON.parse(o);
}

// --- Remote Sync ---
async function fetchBin(binId) {
  const res = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
    headers: { "X-Master-Key": JSONBIN_KEY }
  });
  if(!res.ok) throw new Error("Fehler beim Laden des Bins");
  const data = await res.json();
  return data.record || [];
}

async function saveBin(binId, data) {
  await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
    method: "PUT",
    headers: {
      "Content-Type":"application/json",
      "X-Master-Key": JSONBIN_KEY,
      "X-Bin-Versioning": "false"
    },
    body: JSON.stringify(data)
  });
}

// --- Dish Rendering ---
function renderDishes() {
  const list = document.getElementById("dish-list");
  list.innerHTML = "";
  if(!dishes.length) { list.innerHTML='<div class="empty">Keine Gerichte.</div>'; return; }
  dishes.forEach((dish,i)=>{
    const div = document.createElement("div");
    div.className="item";
    div.innerHTML = `
      <div class="item-header">
        <strong>${dish.name}</strong>
        <div class="actions">
          <button onclick="editDish(${i})" class="ok">‚úèÔ∏è</button>
          <button onclick="deleteDish(${i})" class="danger">üóëÔ∏è</button>
        </div>
      </div>
      <div class="muted">${dish.tags?dish.tags.join(", "):""} - ${dish.price?dish.price+"‚Ç¨":""}</div>
    `;
    list.appendChild(div);
  });
  renderClientPicker();
}

function renderClientPicker() {
  const picker = document.getElementById("client-dish-picker");
  picker.innerHTML = "";
  if(!dishes.length) { picker.innerHTML='<div class="empty">Keine Gerichte verf√ºgbar.</div>'; return; }
  dishes.forEach((dish,i)=>{
    const div = document.createElement("div");
    div.className="dish-checkbox-row";
    div.innerHTML=`<input type="checkbox" id="dish-${i}" value="${i}"><label for="dish-${i}">${dish.name} ${dish.price?`(${dish.price}‚Ç¨)`:""}</label>`;
    picker.appendChild(div);
  });
}

// --- Dish Actions ---
document.getElementById("dish-form").addEventListener("submit", async e=>{
  e.preventDefault();
  const name = document.getElementById("dish-name").value.trim();
  const price = parseFloat(document.getElementById("dish-price").value)||0;
  const tags = document.getElementById("dish-tags").value.split(",").map(t=>t.trim()).filter(Boolean);
  if(!name) return;
  const idx = dishes.findIndex(d=>d.name===name);
  if(idx>=0){ dishes[idx]={name, price, tags}; } else { dishes.push({name, price, tags}); }
  renderDishes();
  saveLocal();
  if(REMOTE_SYNC_DISHES) await saveBin(JSONBIN_DISHES_ID,dishes);
  e.target.reset();
});

function editDish(idx) {
  const d=dishes[idx];
  document.getElementById("dish-name").value=d.name;
  document.getElementById("dish-price").value=d.price||"";
  document.getElementById("dish-tags").value=d.tags?d.tags.join(","):"";
}
function deleteDish(idx){
  if(!confirm("Wirklich l√∂schen?")) return;
  dishes.splice(idx,1);
  renderDishes();
  saveLocal();
  if(REMOTE_SYNC_DISHES) saveBin(JSONBIN_DISHES_ID,dishes);
}
document.getElementById("dish-reset-btn").addEventListener("click",()=>document.getElementById("dish-form").reset());

// --- Orders ---
function renderOrders() {
  const list = document.getElementById("order-list");
  list.innerHTML = "";
  if(!orders.length){ 
    list.innerHTML='<div class="empty">Keine Bestellungen.</div>'; 
    return; 
  }
  orders.forEach((o,i)=>{
    const div = document.createElement("div");
    div.className="item";
    div.innerHTML=`
      <div class="item-header">
        <strong>${o.name}</strong> <span class="muted">${o.destination}</span>
        <div class="actions">
          <button class="ok" onclick="completeOrder(${i})">‚úîÔ∏è Erledigt</button>
        </div>
      </div>
      <ul class="inline-list">
        ${o.items.map(it=>`<li>${it}</li>`).join("")}
      </ul>
    `;
    list.appendChild(div);
  });
}

// --- Order Actions ---
function completeOrder(idx){
  if(!confirm("Markieren als erledigt / l√∂schen?")) return;
  orders.splice(idx,1);
  renderOrders();
  saveLocal();
  if(REMOTE_SYNC_ORDERS) saveBin(JSONBIN_ORDERS_ID,orders);
}

// --- Routing ---
function route() {
  const hash=location.hash.replace("#/","");
  document.getElementById("view-client").hidden=true;
  document.getElementById("view-admin").hidden=true;
  if(hash==="admin"){ document.getElementById("view-admin").hidden=false; }
  else{ document.getElementById("view-client").hidden=false; }
  document.querySelectorAll("nav a.btn").forEach(a=>a.classList.remove("active"));
  document.querySelector(`nav a[href="#/${hash||'client'}"]`)?.classList.add("active");
}

// --- Init ---
async function init() {
  loadLocal();
  if(REMOTE_SYNC_DISHES){ try{ dishes=await fetchBin(JSONBIN_DISHES_ID); }catch(e){ console.warn(e); } }
  if(REMOTE_SYNC_ORDERS){ try{ orders=await fetchBin(JSONBIN_ORDERS_ID); }catch(e){ console.warn(e); } }
  renderDishes();
  renderOrders();
  route();
}
window.addEventListener("hashchange", route);
init();
</script>
</body>
</html>
